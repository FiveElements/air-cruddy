<link rel="import" href="../polymer/polymer.html">

<script>

    /**
     * @demo demo/index.html
     * @polymerBehavior
     */
    Polymer.AirCruddyFetchehavior = {

//        properties: {
//            /**
//             * The base of all CRUD url to manage the REST entity.
//             * The Pattern to respect is :
//             * For getting : GET to url  {{endpoint}}/entityId
//             * For getting : POST to url {{endpoint}}
//             * For updating : PUT to url {{endpoint}}
//             * For deleting : DELETE to url {{endpoint}}
//             */
//            endpoint: String,
//
//            /**
//             * Computed entity Rest Url
//             */
//            entityUrl: {
//                type: String,
//                computed: '_computeEndpointEntityUrl(endpoint, entityId)'
//            }
//        },
        ready: function () {
        },
        // --- Compute Properties
        // --- ---------------------
        _computeEndpointEntityUrl: function () {
            return this.endpoint + '/' + this.entityId;
        },

        // --- Entity GET
        // --- ---------------------

        _handleFormResponse: function (event) {
            this.fire('fire-form-response', event.detail.response);
        },
        _handleFormError: function (event) {
            this.fire('fire-form-error', event.detail);
        },

        entityGet: function () {
            fetch(this.entityUrl)
                    .then(function (response) {
                        return response.json()
                    }).then(function (json) {
                        console.log('parsed json', json)
                    }).catch(function (ex) {
                        console.log('parsing failed', ex)
                    });
        },

        /**
         * Called to submit the form.
         */
        submit: function (event) {
            if (!this._validate()) {
                return false;
            }
            var json = this.serialize();
            this._requestBot.url = this.action;
            this._requestBot.method = this.method;
            this._requestBot.params = json;
            if (this.method == 'POST') {
                this._requestBot.body = JSON.stringify(json);
            }
            this._requestBot.generateRequest();
            this.fire('fire-form-submit', json);
            // Don't perform a page refresh.
            if (event) {
                event.preventDefault();
            }
            return false;
        }


    };
</script>
