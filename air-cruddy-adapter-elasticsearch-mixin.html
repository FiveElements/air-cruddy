<link rel="import" href="../polymer/polymer.html">

<script>
    'use strict';

    /**
     * FiveElements Namespace definition
     */
    var FiveElements = FiveElements || {};

    /**
     * @polymerBehavior
     */
    FiveElements.AirCruddyAdapterElasticsearchBehavior = {



        _transformToServerSavePartial: function (opt) {
            // Manage Differential
            if (opt.data) {
                var data = JSON.parse(JSON.stringify(opt.data));
                delete data.id;
                delete data.version;
                opt.data = {
                    "doc": data
                };
            }
            return opt;
        },



        // --- Elasticsearch API Transformer
        // --- ---------------------------

        /**
         * Adapt response from Retrieve Web-Service o the expected format
         * ```
         * {
             *   id: '',
             *   version: '',
             *   ...
             * }
         * ```
         */
        _adapterResponseRetrieve: function (res) {
            console.log('-----> _adapterResponseRetrieve : ', JSON.stringify(res));
            var responseJson = res.response;
            if (responseJson) {
                var data = JSON.parse(JSON.stringify(responseJson._source));
                data.id = responseJson._id;
                data.version = responseJson._version;
                // define
                res.response = data;
            }
            return res;
        },

        /**
         * Adapt response from Update Web-Service o the expected format
         * ```
         * { status: 200,
         *   statusText: 'OK',
         *   response: {
         *        id: '',
         *        version: '',
         *   ...
         *   }
         * }
         * ```
         */
        _adapterResponseElasticsearch: function (res) {
            var body = res.response;
            if (body) {
                var adaptJson = {
                    id: body._id,
                    version: body._version
                };
                body = Object.assign(adaptJson, body);
                delete body._id;
                delete  body._version;
                res.response = body;
            }
            return res;
        },


        /**
         * Adapt response from Update Web-Service o the expected format
         * ```
         * { status: 200,
         *   statusText: 'OK',
         *   response: {
         *        id: '',
         *        version: '',
         *   ...
         *   }
         * }
         * ```
         */
        _adapterResponseUpdate: function (res) {
            return this._adapterResponseElasticsearch(res);
        },


        /**
         * Adapt response from Create Web-Service o the expected format
         * ```
         * { status: 200,
         *   statusText: 'OK',
         *   response: {
         *        id: 'The New entity Id',
         *        version: 'The New version',
         *   ...
         *   }
         * }
         * ```
         */
        _adapterResponseCreate: function (res) {
            return this._adapterResponseElasticsearch(res);
        },


        /**
         * Adapt response from Delete Web-Service o the expected format
         * ```
         * { status: 200,
         *   statusText: 'OK',
         *   response: {
         *        id: 'The New entity Id',
         *        version: 'The New version',
         *   ...
         *   }
         * }
         * ```
         */
        _adapterResponseDelete: function (res) {
            return this._adapterResponseElasticsearch(res);
        },

    }


</script>