<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="air-cruddy-differential-behaviour.html">

<script>
    /**
     * FiveElements Namespace definition
     */
    var FiveElements = FiveElements || {};

    /**
     * @polymerBehavior
     */
    FiveElements.AirCruddyAutoSaveBehavior = {

        properties: {},

        listeners: {
            'bind-value-changed': '_handleBlur',
           // 'focusout':  '_handleBlur'
        },
            // --- Api
        // --- ---------------------

        ready: function () {

        },

        _handleBlur: function (event) {
            console.log('°°°°°°°°°°°°°°°°°° _handleBlur', event);
        },

        // --- AutoSave
        // --- ---------------------
        addInputWatcher: function (focusable) {
            var that = this;
            //
            this.focusListener = this.focusListener || this.autoSaveInputFieldFocus.bind(this);
            this.blurListener = this.blurAction || this.autoSaveInputFieldBlur.bind(this);
            // Add Event
            Polymer.addEventListener(focusable, 'input', that.focusListener, true);
            Polymer.addEventListener(focusable, 'blur', that.blurListener, true);
        },

        removeInputWatcher: function (childNode) {
            var that = this;
            Polymer.removeEventListener(childNode, 'blur', that.blurListener, true);
            Polymer.removeEventListener(childNode, 'input', that.focusListener, true);
        },

        // --- Logic
        // --- ---------------------
        autoSaveInputFieldBlur: function () {
            console.log('*** Blur ', event);
//        var autosave = this.isModeCreate ? (this.autocreate === '' || this.autocreate === true) : ( this.autosave === '' || this.autosave === true );
            // Auto save
            if (this.isAutosave && this._diffDataSource()) {
                // console.log('---- autoSaveInputFieldBlur', this.data);
                this.job('save', function () {
                    this.save();
                }, 200);
            }
        },
        autoSaveInputFieldFocus: function () {
            console.log('*** Focus ', event);
            if (this.isAutosave) {
                this.crudStatus.toSave = true;
            }
        },

    };


</script>