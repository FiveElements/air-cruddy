<link rel="import" href="../polymer/polymer.html">


<link rel="import" href="air-cruddy-behaviour.html">
<link rel="import" href="air-cruddy-cloudy-init-behaviour.html">
<link rel="import" href="air-cruddy-response-409-behaviour.html">
<link rel="import" href="../air-cascade-validator/air-cascade-validator-behaviour.html">
<link rel="import" href="air-cruddy-dirty-behaviour.html">
<link rel="import" href="air-cruddy-element-behaviour.html">


<!--

The `air-cruddy` provides lightweight way to implement all CRUD (Create, Retrieve, Update, Delete) Operations on an REST Api with all the expected services :
 - Validation
 - Conflict Resolution on 409
 - Auto Save Feature




    <air-cruddy entity-id="{{entityid}}" data="{{data}}" endpoint="/v1/users" autosave>
        <section>
           <paper-input-decorator floatingLabel label="First name" autoValidate>
              <input is="core-input" value="{{data._source.firstname}}" required>
           </paper-input-decorator>
           <paper-input-decorator floatingLabel label="First name" autoValidate>
              <input is="core-input" value="{{data._source.lastname}}" required>
           </paper-input-decorator>
        </section>
    </air-cruddy>

### Server Data Format
Example of Get Entity Server Format:

    { _id: "AAApkZAAOAAAQYEAAJ",
      _version: 1,
      _source: {
        firstname: "Leeloominaï",
        lastname: "Lekatariba Lamina-Tchaï Ekbat De Sebat"
      }
    }



### Validation
TODO



### Conflict Resolution
When Save Error 409 is raised from server
AutoSave
---------
Attribute available:
 - autosave
 - autocreate
 - autoupdate

@group Air Elements
@element air-cruddy
@demo demo/index.html
-->

<dom-module id="air-cruddy">

    <style>
        :host {
            display: block;
        }

        .content-wrapper-hide {
            display: none;
        }

    </style>
    <template>
        <div id="contentWrapper" class="content-wrapper-hide">
            <content></content>
        </div>
    </template>
</dom-module>

<script>
    (function () {
        'use strict';

        Polymer({
            is: 'air-cruddy',

            properties: {

            },

            observers: [
                'dataChanged(data)'
            ],

            behaviors: [
                FiveElements.AirCruddyBehavior
                , FiveElements.AirCruddyAjaxInitBehavior
                , FiveElements.AirCruddyResponse409Behavior
                , FiveElements.AirCascadeValidatorBehavior
                , FiveElements.AirCruddyDirtyBehavior
                , FiveElements.AirCruddyElementBehavior
            ],

            dataChanged: function (newValue) {
                if (newValue) {
                    this._showContent(true);
                } else {
                    this._showContent(false);
                }
            },

            _showContent: function (toShow) {
                this.toggleClass('content-wrapper-hide', !toShow, this.$.contentWrapper);
            }



        });
    })();
</script>